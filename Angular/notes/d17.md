# Day 17: Angular Templates - Control Flow and Data Binding

## Data Binding

Angular provides several ways to bind data between components and templates.

### 1. Interpolation: {{ }}

Display component properties in the template:

```typescript
@Component({
  template: `
    <h1>Welcome, {{ username }}!</h1>
    <p>You have {{ taskCount }} tasks</p>
    <p>Current time: {{ currentTime }}</p>
  `,
})
export class MyComponent {
  username = "John";
  taskCount = 5;
  currentTime = new Date();
}
```

### 2. Property Binding: [property]

Bind component properties to DOM element properties:

```typescript
@Component({
  template: `
    <!-- Binding to element properties -->
    <img [src]="imageUrl" />
    <button [disabled]="isDisabled">Click me</button>
    <div [title]="tooltipText">Hover me</div>

    <!-- Binding to component properties -->
    <app-task [task]="currentTask"></app-task>
  `,
})
export class MyComponent {
  imageUrl = "https://example.com/image.png";
  isDisabled = false;
  tooltipText = "This is a tooltip";
  currentTask = { id: 1, title: "Learn Angular" };
}
```

### 3. Event Binding: (event)

Handle DOM events:

```typescript
@Component({
  template: `
    <button (click)="onButtonClick()">Click me</button>
    <input (keyup)="onKeyUp($event)" />
    <form (submit)="onSubmit()">
      <input type="submit" value="Submit" />
    </form>
  `,
})
export class MyComponent {
  onButtonClick(): void {
    console.log("Button clicked");
  }

  onKeyUp(event: any): void {
    const value = event.target.value;
    console.log("Input value:", value);
  }

  onSubmit(): void {
    console.log("Form submitted");
  }
}
```

### 4. Two-Way Binding: [(ngModel)]

Bind to form input values:

```typescript
import { CommonModule } from "@angular/common";
import { FormsModule } from "@angular/forms";

@Component({
  standalone: true,
  imports: [CommonModule, FormsModule],
  template: `
    <input [(ngModel)]="name" />
    <p>Hello, {{ name }}!</p>

    <input type="checkbox" [(ngModel)]="isSubscribed" />
    <p>Subscribed: {{ isSubscribed }}</p>

    <select [(ngModel)]="selectedOption">
      <option value="option1">Option 1</option>
      <option value="option2">Option 2</option>
    </select>
    <p>Selected: {{ selectedOption }}</p>
  `,
})
export class MyComponent {
  name = "";
  isSubscribed = false;
  selectedOption = "option1";
}
```

### 5. Class Binding: [class]

Dynamically add/remove CSS classes:

```typescript
@Component({
  template: `
    <!-- Single class -->
    <div [class.active]="isActive">Active?</div>

    <!-- Multiple classes -->
    <div [class]="'button btn-primary'">Button</div>

    <!-- Object syntax (recommended) -->
    <div [ngClass]="{ active: isActive, disabled: isDisabled }">
      Dynamic Classes
    </div>
  `,
  styles: [
    `
      .active {
        color: green;
      }
      .disabled {
        opacity: 0.5;
      }
    `,
  ],
})
export class MyComponent {
  isActive = true;
  isDisabled = false;
}
```

### 6. Style Binding: [style]

Dynamically set inline styles:

```typescript
@Component({
  template: `
    <!-- Single style -->
    <div [style.color]="textColor">Colored text</div>

    <!-- Multiple styles -->
    <div [ngStyle]="{ color: textColor, 'font-size': fontSize }">
      Styled text
    </div>
  `,
})
export class MyComponent {
  textColor = "red";
  fontSize = "20px";
}
```

---

## Control Flow Directives

Angular 17+ introduces new control flow syntax (replacing *ngIf, *ngFor, etc.):

### 1. @if Block

```typescript
@Component({
  template: `
    <!-- New syntax (Angular 17+) -->
    @if (isLoggedIn) {
    <p>Welcome, {{ username }}!</p>
    } @else if (isPending) {
    <p>Loading...</p>
    } @else {
    <a href="/login">Please log in</a>
    }
  `,
})
export class MyComponent {
  isLoggedIn = true;
  isPending = false;
  username = "John";
}
```

### 2. @for Loop

```typescript
@Component({
  template: `
    <!-- New syntax (Angular 17+) -->
    <ul>
      @for (task of tasks; track task.id) {
      <li>
        {{ task.title }}
        <button (click)="deleteTask(task.id)">Delete</button>
      </li>
      } @empty {
      <li>No tasks found</li>
      }
    </ul>
  `,
})
export class MyComponent {
  tasks = [
    { id: 1, title: "Learn Angular" },
    { id: 2, title: "Build app" },
  ];

  deleteTask(id: number): void {
    this.tasks = this.tasks.filter((t) => t.id !== id);
  }
}
```

### 3. @switch Statement

```typescript
@Component({
  template: `
    <!-- New syntax (Angular 17+) -->
    @switch (userRole) { @case ('admin') {
    <p>Welcome, admin!</p>
    } @case ('user') {
    <p>Welcome, user!</p>
    } @default {
    <p>Unknown role</p>
    } }
  `,
})
export class MyComponent {
  userRole = "admin";
}
```

---

## Legacy Control Flow (Angular 16 and earlier)

### \*ngIf Directive

```typescript
@Component({
  standalone: true,
  imports: [CommonModule],
  template: `
    <div *ngIf="isLoggedIn; else notLoggedIn">
      <p>Welcome, {{ username }}!</p>
    </div>

    <ng-template #notLoggedIn>
      <p>Please log in</p>
    </ng-template>
  `,
})
export class MyComponent {
  isLoggedIn = true;
  username = "John";
}
```

### \*ngFor Directive

```typescript
@Component({
  standalone: true,
  imports: [CommonModule],
  template: `
    <ul>
      <li *ngFor="let task of tasks; let i = index">
        {{ i + 1 }}. {{ task.title }}
      </li>
    </ul>
  `,
})
export class MyComponent {
  tasks = [
    { id: 1, title: "Learn Angular" },
    { id: 2, title: "Build app" },
  ];
}
```

### \*ngSwitch Directive

```typescript
@Component({
  standalone: true,
  imports: [CommonModule],
  template: `
    <div [ngSwitch]="userRole">
      <p *ngSwitchCase="'admin'">You are an admin</p>
      <p *ngSwitchCase="'user'">You are a user</p>
      <p *ngSwitchDefault>Unknown role</p>
    </div>
  `,
})
export class MyComponent {
  userRole = "user";
}
```

---

## Attribute Binding

Bind to HTML attributes (not DOM properties):

```typescript
@Component({
  template: `
    <!-- Property binding (recommended for most cases) -->
    <img [src]="imageUrl" />

    <!-- Attribute binding (for attributes without DOM properties) -->
    <button [attr.aria-label]="buttonLabel">Button</button>

    <!-- Also good for non-standard attributes -->
    <div [attr.data-id]="userId">Content</div>
  `,
})
export class MyComponent {
  imageUrl = "image.png";
  buttonLabel = "Click me";
  userId = 123;
}
```

---

## Pipes: Transform Data in Templates

Pipes format data for display:

```typescript
@Component({
  template: `
    <!-- Built-in pipes -->
    <p>{{ price | currency }}</p>
    <p>{{ birthDate | date : "short" }}</p>
    <p>{{ name | uppercase }}</p>
    <p>{{ items | slice : 0 : 3 }}</p>

    <!-- Chaining pipes -->
    <p>{{ price | currency | uppercase }}</p>

    <!-- Pipe with arguments -->
    <p>{{ message | slice : 0 : 5 }}</p>
  `,
})
export class MyComponent {
  price = 100;
  birthDate = new Date("1990-01-01");
  name = "john";
  items = [1, 2, 3, 4, 5];
  message = "Hello World";
}
```

### Common Built-in Pipes

```
AsyncPipe        | await {{ asyncValue | async }}
CurrencyPipe     | {{ price | currency }}
DatePipe         | {{ date | date: 'short' }}
DecimalPipe      | {{ number | number: '1.2-2' }}
JsonPipe         | {{ object | json }}
KeyValuePipe     | *ngFor="let item of object | keyvalue"
LowercasePipe    | {{ text | lowercase }}
UppercasePipe    | {{ text | uppercase }}
PercentPipe      | {{ 0.25 | percent }}
SlicePipe        | {{ array | slice: 0:3 }}
TitlecasePipe    | {{ 'hello world' | titlecase }}
```

---

## Safe Navigation Operator: ?

Prevents errors when accessing properties on undefined objects:

```typescript
@Component({
  template: `
    <!-- Without safe navigation (can error) -->
    <p>{{ user.profile.avatar }}</p>

    <!-- With safe navigation (safe) -->
    <p>{{ user?.profile?.avatar }}</p>

    <!-- In ngIf -->
    <p *ngIf="user?.profile">Profile exists</p>
  `,
})
export class MyComponent {
  user: any = null; // Could be null
}
```

---

## Template Reference Variables:

Reference DOM elements or components:

```typescript
@Component({
  standalone: true,
  imports: [FormsModule],
  template: `
    <input #nameInput type="text" />
    <button (click)="displayValue(nameInput)">Show Value</button>

    <app-child #childComponent></app-child>
    <button (click)="callChildMethod(childComponent)">Call Child</button>
  `,
})
export class MyComponent {
  displayValue(input: any): void {
    console.log(input.value);
  }

  callChildMethod(child: any): void {
    child.someMethod();
  }
}
```

---

## Event Object: $event

Access event details:

```typescript
@Component({
  template: `
    <!-- Native DOM event -->
    <input (keyup)="onKeyUp($event)" />

    <!-- Component output event -->
    <app-child (itemSelected)="onItemSelected($event)"></app-child>
  `,
})
export class MyComponent {
  onKeyUp(event: KeyboardEvent): void {
    const value = (event.target as HTMLInputElement).value;
    console.log(value);
  }

  onItemSelected(item: any): void {
    console.log("Selected:", item);
  }
}
```

---

## Summary

- **Data Binding:** Connects component properties to templates
- **Interpolation:** Display values with {{ }}
- **Property Binding:** Bind to element properties with [ ]
- **Event Binding:** Handle events with ( )
- **Two-Way Binding:** Synchronize data with [(ngModel)]
- **Class/Style Binding:** Dynamically add classes and styles
- **Control Flow:** Use @if, @for, @switch for conditional rendering (Angular 17+)
- **Pipes:** Transform data for display
- **Safe Navigation:** Use ? to prevent null reference errors
- **Template Variables:** Reference elements with #variable
